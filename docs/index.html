<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>Home - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="BufferMethodIntType.html">BufferMethodIntType</a><ul class='methods'><li data-type='method'><a href="BufferMethodIntType.html#compiledDecoder">compiledDecoder</a></li><li data-type='method'><a href="BufferMethodIntType.html#compiledEncoder">compiledEncoder</a></li><li data-type='method'><a href="BufferMethodIntType.html#decode">decode</a></li><li data-type='method'><a href="BufferMethodIntType.html#encode">encode</a></li></ul></li><li><a href="Constant.html">Constant</a><ul class='methods'><li data-type='method'><a href="Constant.html#compiledDecoder">compiledDecoder</a></li><li data-type='method'><a href="Constant.html#compiledEncoder">compiledEncoder</a></li><li data-type='method'><a href="Constant.html#decode">decode</a></li><li data-type='method'><a href="Constant.html#encode">encode</a></li></ul></li><li><a href="Data.html">Data</a><ul class='methods'><li data-type='method'><a href="Data.html#compiledDecoder">compiledDecoder</a></li><li data-type='method'><a href="Data.html#compiledEncoder">compiledEncoder</a></li><li data-type='method'><a href="Data.html#decode">decode</a></li><li data-type='method'><a href="Data.html#encode">encode</a></li></ul></li><li><a href="Int16.html">Int16</a><ul class='methods'><li data-type='method'><a href="Int16.html#compiledDecoder">compiledDecoder</a></li><li data-type='method'><a href="Int16.html#compiledEncoder">compiledEncoder</a></li><li data-type='method'><a href="Int16.html#decode">decode</a></li><li data-type='method'><a href="Int16.html#encode">encode</a></li></ul></li><li><a href="Int32.html">Int32</a><ul class='methods'><li data-type='method'><a href="Int32.html#compiledDecoder">compiledDecoder</a></li><li data-type='method'><a href="Int32.html#compiledEncoder">compiledEncoder</a></li><li data-type='method'><a href="Int32.html#decode">decode</a></li><li data-type='method'><a href="Int32.html#encode">encode</a></li></ul></li><li><a href="OneOf.html">OneOf</a><ul class='methods'><li data-type='method'><a href="OneOf.html#compiledDecoder">compiledDecoder</a></li><li data-type='method'><a href="OneOf.html#compiledEncoder">compiledEncoder</a></li><li data-type='method'><a href="OneOf.html#decode">decode</a></li><li data-type='method'><a href="OneOf.html#encode">encode</a></li></ul></li><li><a href="Optional.html">Optional</a><ul class='methods'><li data-type='method'><a href="Optional.html#compiledDecoder">compiledDecoder</a></li><li data-type='method'><a href="Optional.html#compiledEncoder">compiledEncoder</a></li><li data-type='method'><a href="Optional.html#decode">decode</a></li><li data-type='method'><a href="Optional.html#encode">encode</a></li></ul></li><li><a href="StringType.html">StringType</a><ul class='methods'><li data-type='method'><a href="StringType.html#compiledDecoder">compiledDecoder</a></li><li data-type='method'><a href="StringType.html#compiledEncoder">compiledEncoder</a></li><li data-type='method'><a href="StringType.html#decode">decode</a></li><li data-type='method'><a href="StringType.html#encode">encode</a></li></ul></li><li><a href="Structure.html">Structure</a><ul class='methods'><li data-type='method'><a href="Structure.html#compiledDecoder">compiledDecoder</a></li><li data-type='method'><a href="Structure.html#compiledEncoder">compiledEncoder</a></li><li data-type='method'><a href="Structure.html#decode">decode</a></li><li data-type='method'><a href="Structure.html#encode">encode</a></li></ul></li><li><a href="TranscodableArray.html">TranscodableArray</a><ul class='methods'><li data-type='method'><a href="TranscodableArray.html#compiledDecoder">compiledDecoder</a></li><li data-type='method'><a href="TranscodableArray.html#compiledEncoder">compiledEncoder</a></li><li data-type='method'><a href="TranscodableArray.html#decode">decode</a></li><li data-type='method'><a href="TranscodableArray.html#encode">encode</a></li></ul></li><li><a href="TranscodableType.html">TranscodableType</a><ul class='methods'><li data-type='method'><a href="TranscodableType.html#compiledDecoder">compiledDecoder</a></li><li data-type='method'><a href="TranscodableType.html#compiledEncoder">compiledEncoder</a></li><li data-type='method'><a href="TranscodableType.html#decode">decode</a></li><li data-type='method'><a href="TranscodableType.html#encode">encode</a></li></ul></li><li><a href="Uint8.html">Uint8</a><ul class='methods'><li data-type='method'><a href="Uint8.html#compiledDecoder">compiledDecoder</a></li><li data-type='method'><a href="Uint8.html#compiledEncoder">compiledEncoder</a></li><li data-type='method'><a href="Uint8.html#decode">decode</a></li><li data-type='method'><a href="Uint8.html#encode">encode</a></li></ul></li><li><a href="Uint16.html">Uint16</a><ul class='methods'><li data-type='method'><a href="Uint16.html#compiledDecoder">compiledDecoder</a></li><li data-type='method'><a href="Uint16.html#compiledEncoder">compiledEncoder</a></li><li data-type='method'><a href="Uint16.html#decode">decode</a></li><li data-type='method'><a href="Uint16.html#encode">encode</a></li></ul></li><li><a href="Uint32.html">Uint32</a><ul class='methods'><li data-type='method'><a href="Uint32.html#compiledDecoder">compiledDecoder</a></li><li data-type='method'><a href="Uint32.html#compiledEncoder">compiledEncoder</a></li><li data-type='method'><a href="Uint32.html#decode">decode</a></li><li data-type='method'><a href="Uint32.html#encode">encode</a></li></ul></li><li><a href="Varint.html">Varint</a><ul class='methods'><li data-type='method'><a href="Varint.html#compiledDecoder">compiledDecoder</a></li><li data-type='method'><a href="Varint.html#compiledEncoder">compiledEncoder</a></li><li data-type='method'><a href="Varint.html#decode">decode</a></li><li data-type='method'><a href="Varint.html#encode">encode</a></li></ul></li></ul>
</nav>

<div id="main">
    

    



    


    <section class="package">
        <h3> </h3>		
    </section>









    



    <section class="readme">
        <article><h1><a href="https://github.com/walasek/node-binary-encoder">node-binary-encoder</a> <a href="https://travis-ci.org/walasek/node-binary-encoder"><img src="https://img.shields.io/travis/walasek/node-binary-encoder.svg?style=flat-square" alt="Build Status"></a> <a href="https://www.npmjs.com/walasek/node-binary-encoder"><img src="https://img.shields.io/npm/v/binary-encoder.svg?style=flat-square" alt="Package Version"></a> <img src="https://img.shields.io/npm/l/binary-encoder.svg?style=flat-square" alt="License"> <a href="https://david-dm.org/walasek/node-binary-encoder.svg"><img src="https://david-dm.org/walasek/node-binary-encoder.svg" alt="Dependencies"></a>  <a href="https://codecov.io/gh/walasek/node-binary-encoder"><img src="https://codecov.io/gh/walasek/node-binary-encoder/branch/master/graph/badge.svg" alt="codecov"></a></h1>
<p>Quick and consistent binary encoding of data structures.</p>
<hr>
<h2>Goal</h2>
<p>Encoding data in raw buffers is a difficult task especially in terms of description of the encoding and decoding process. This project aims to deliver tools for easy description of data structures that can be encoded into raw buffers, and decoded from raw buffers and data streams.</p>
<h2>Installation</h2>
<p>Node <code>&gt;=8.9.0</code> is required.</p>
<pre class="prettyprint source lang-bash"><code>npm install --save binary-encoder
</code></pre>
<p>To perform tests use:</p>
<pre class="prettyprint source lang-bash"><code>cd node_modules/binary-encoder
npm i
npm t
</code></pre>
<p>This project also has a benchmark that you can run yourself:</p>
<pre class="prettyprint source lang-bash"><code>cd node_modules/binary-encoder
npm i
npm run benchmark
</code></pre>
<h2>Usage</h2>
<p>Beware this project is still in development. There may be serious bugs or performance issues over time.</p>
<p>Documentation is available <a href="https://walasek.github.io/node-binary-encoder/">here</a>.</p>
<pre class="prettyprint source lang-javascript"><code>const bin = require('binary-encoder');

// A basic structure definition
const Person = bin.Structure({
    first_name: bin.String(),
    age: bin.Uint32(),
});

const Image = bin.Structure({
    binary: bin.Data(),
});
const Link = bin.Structure({
    url: bin.String(),
});

// A Protobuf-style OneOf union
const Attachment = bin.OneOf({
    image: Image,
    link: Link,
});

// Definitions can be nested
const MyMessage = bin.Structure({
    title: bin.String(),
    from: Person,
    to: Person,
    content: bin.String(),
    attachments: bin.Array(Attachment),
});

// Any type or definition can be encoded and decoded
const my_message = {
    title: 'binary-encoder',
    from: {first_name: 'Karol', age: 25},
    to: {first_name: 'Jon', age: 30},
    content: 'This library is awesome!',
    attachments: [
        {link: {url: 'https://github.com/walasek/node-binary-encoder'}},
    ],
};
const buffer = MyMessage.encode(my_message);
// socket.send(buffer); fs.writeFileSync(..., buffer); or something else here
// ...
// socket.on('data', ...); fs.readFilesync(...); or something else here
const message = MyMessage.decode(buffer);
// t.deepEqual(message, my_message, 'This would pass');

// EXPERIMENTAL API
// The following functions will be removed in the future.
// Generate a more efficient function to encode/decode.
const encoder = bin.compileEncoder(MyMessage);
const decoder = bin.compileEncoder(MyMessage);

// This is approximately 100% faster than recursive functions, but experimental at this time.
// For the maximum speed use a temporary buffer (allocated once)
const tmp = Buffer.alloc(1024);
encoder(my_message, tmp);
// ...
message = decoder(tmp);
message = MyMessage.decode(tmp); // Backwards compatible
</code></pre>
<h2>API</h2>
<h3>Basic Types</h3>
<table>
<thead>
<tr>
<th>Type</th>
<th>Usage</th>
<th>Size</th>
</tr>
</thead>
<tbody>
<tr>
<td>Uint8</td>
<td>A byte of data (value range 0-255)</td>
<td>1</td>
</tr>
<tr>
<td>Uint16</td>
<td>Two bytes of data (value range 0-(2^16-1))</td>
<td>2</td>
</tr>
<tr>
<td>Int16</td>
<td>Two bytes signed (value range -32768:32767)</td>
<td>2</td>
</tr>
<tr>
<td>Uint32</td>
<td>Little-endian unsigned int (0-(2^32-1))</td>
<td>4</td>
</tr>
<tr>
<td>Int32</td>
<td>Found bytes signed (value range -2^16:2^16-1)</td>
<td>4</td>
</tr>
<tr>
<td>Varint</td>
<td>A Protobuf-style Varint, same value range as Uint32</td>
<td>1-5</td>
</tr>
</tbody>
</table>
<h3>Structures</h3>
<table>
<thead>
<tr>
<th>Type</th>
<th>Usage</th>
<th>Size</th>
</tr>
</thead>
<tbody>
<tr>
<td>Structure</td>
<td>An object that maps types to keys. Order matters. All fields must be present, additional fields that are not declared earlier will not be encoded.</td>
<td>Sum of fields</td>
</tr>
<tr>
<td>Array</td>
<td>A list of values (can be of any type). Variable length by default, can be set as fixed size.</td>
<td>Sum of values (+ <em>Varint</em> size if the array is not fixed size)</td>
</tr>
<tr>
<td>OneOf</td>
<td>Protobuf-style <em>OneOf</em> which allows only one member to be encoded. Can be considered as a C-style <em>union</em>.</td>
<td><em>Varint</em> size + value size</td>
</tr>
</tbody>
</table>
<h3>Advanced Types</h3>
<table>
<thead>
<tr>
<th>Type</th>
<th>Usage</th>
<th>Size</th>
</tr>
</thead>
<tbody>
<tr>
<td>Constant</td>
<td>A Uint8 constant. If attempting to decode or encode a different value an exception is thrown.</td>
<td>1 (Uint8)</td>
</tr>
<tr>
<td>Optional</td>
<td>Marks a field as optional (null if not present).</td>
<td>1 + value size (if set)</td>
</tr>
<tr>
<td>Data</td>
<td>A generic binary buffer. Equivalent to an Array of Uint8's. Can be fixed size.</td>
<td>(Array)</td>
</tr>
<tr>
<td>String</td>
<td>A UTF-8 encoded string. Equivalent to Data with some post processing. Can be fixed size.</td>
<td>(Array)</td>
</tr>
</tbody>
</table>
<h2>Benchmarks</h2>
<p>The following benchmark compares Protobuf to this implementation for some basic data structure and a long string of length at least N. <code>binary-encoder-buf</code> uses a preallocated buffer for all operations. <code>binary-encoder-compiled</code> uses an experimental API that generates a structural function (rather than recursive) that is much more efficient.</p>
<pre class="prettyprint source"><code>protobuf (encode) x 263,847 ops/sec ±2.28% (85 runs sampled)
binary-encoder (encode) x 64,397 ops/sec ±3.27% (77 runs sampled)
binary-encoder-buf (encode) x 166,912 ops/sec ±2.63% (80 runs sampled)
binary-encoder-compiled (encode) x 252,473 ops/sec ±2.53% (83 runs sampled)
binary-encoder-compiled-buf (encode) x 368,113 ops/sec ±2.07% (85 runs sampled)
json (encode) x 304,341 ops/sec ±2.20% (88 runs sampled)
Fastest Encoding for N=10 is binary-encoder-compiled-buf (encode)

protobuf (decode) x 888,844 ops/sec ±2.16% (81 runs sampled)
binary-encoder (decode) x 305,803 ops/sec ±2.70% (76 runs sampled)
binary-encoder-compiled (decode) x 570,504 ops/sec ±1.87% (88 runs sampled)
json (decode) x 1,087,999 ops/sec ±2.08% (87 runs sampled)
Fastest Decoding for N=10 is json (decode)

Message sizes:
protobuf 102 bytes
binary-encoder 95
json 265

protobuf (encode) x 248,611 ops/sec ±2.20% (84 runs sampled)
binary-encoder (encode) x 69,762 ops/sec ±1.77% (84 runs sampled)
binary-encoder-buf (encode) x 171,689 ops/sec ±3.98% (81 runs sampled)
binary-encoder-compiled (encode) x 224,163 ops/sec ±3.91% (75 runs sampled)
binary-encoder-compiled-buf (encode) x 332,148 ops/sec ±3.53% (79 runs sampled)
json (encode) x 125,643 ops/sec ±2.27% (83 runs sampled)
Fastest Encoding for N=100 is binary-encoder-compiled-buf (encode)

protobuf (decode) x 849,158 ops/sec ±3.50% (83 runs sampled)
binary-encoder (decode) x 309,057 ops/sec ±2.86% (78 runs sampled)
binary-encoder-compiled (decode) x 481,219 ops/sec ±4.96% (74 runs sampled)
json (decode) x 631,153 ops/sec ±1.97% (87 runs sampled)
Fastest Decoding for N=100 is protobuf (decode)

Message sizes:
protobuf 190 bytes
binary-encoder 183
json 529

protobuf (encode) x 218,729 ops/sec ±3.15% (78 runs sampled)
binary-encoder (encode) x 64,804 ops/sec ±2.43% (85 runs sampled)
binary-encoder-buf (encode) x 173,645 ops/sec ±2.57% (82 runs sampled)
binary-encoder-compiled (encode) x 218,610 ops/sec ±3.87% (73 runs sampled)
binary-encoder-compiled-buf (encode) x 357,404 ops/sec ±2.50% (84 runs sampled)
json (encode) x 18,060 ops/sec ±2.86% (85 runs sampled)
Fastest Encoding for N=1000 is binary-encoder-compiled-buf (encode)

protobuf (decode) x 907,313 ops/sec ±1.46% (89 runs sampled)
binary-encoder (decode) x 339,065 ops/sec ±1.98% (86 runs sampled)
binary-encoder-compiled (decode) x 580,952 ops/sec ±1.68% (86 runs sampled)
json (decode) x 138,365 ops/sec ±1.58% (90 runs sampled)
Fastest Decoding for N=1000 is protobuf (decode)

Message sizes:
protobuf 1091 bytes
binary-encoder 1084
json 3229

protobuf (encode) x 143,791 ops/sec ±4.72% (76 runs sampled)
binary-encoder (encode) x 44,473 ops/sec ±3.73% (81 runs sampled)
binary-encoder-buf (encode) x 162,560 ops/sec ±2.35% (82 runs sampled)
binary-encoder-compiled (encode) x 82,039 ops/sec ±6.18% (65 runs sampled)
binary-encoder-compiled-buf (encode) x 289,004 ops/sec ±3.98% (81 runs sampled)
json (encode) x 1,675 ops/sec ±5.04% (77 runs sampled)
Fastest Encoding for N=10000 is binary-encoder-compiled-buf (encode)

protobuf (decode) x 848,061 ops/sec ±3.28% (82 runs sampled)
binary-encoder (decode) x 338,013 ops/sec ±1.77% (84 runs sampled)
binary-encoder-compiled (decode) x 563,351 ops/sec ±2.63% (84 runs sampled)
json (decode) x 16,073 ops/sec ±0.91% (93 runs sampled)
Fastest Decoding for N=10000 is protobuf (decode)

Message sizes:
protobuf 10091 bytes
binary-encoder 10084
json 30229

protobuf (encode) x 35,712 ops/sec ±8.44% (72 runs sampled)
binary-encoder (encode) x 11,461 ops/sec ±6.95% (75 runs sampled)
binary-encoder-buf (encode) x 99,910 ops/sec ±1.93% (87 runs sampled)
binary-encoder-compiled (encode) x 15,237 ops/sec ±5.31% (82 runs sampled)
binary-encoder-compiled-buf (encode) x 149,437 ops/sec ±1.35% (90 runs sampled)
json (encode) x 171 ops/sec ±3.47% (72 runs sampled)
Fastest Encoding for N=100000 is binary-encoder-compiled-buf (encode)

protobuf (decode) x 842,279 ops/sec ±2.77% (82 runs sampled)
binary-encoder (decode) x 316,650 ops/sec ±2.88% (81 runs sampled)
binary-encoder-compiled (decode) x 591,702 ops/sec ±1.93% (85 runs sampled)
json (decode) x 1,632 ops/sec ±0.68% (91 runs sampled)
Fastest Decoding for N=100000 is protobuf (decode)

Message sizes:
protobuf 100092 bytes
binary-encoder 100085
json 300229

Results in CSV for plots:
,protobuf (encode),binary-encoder (encode),binary-encoder-buf (encode),binary-encoder-compiled (encode),binary-encoder-compiled-buf (encode),json (encode)
10,263846.9073576735,64396.66812325595,166912.4244514077,252472.81891420262,368113.2204249347,304340.9733025798
100,248611.2680726218,69761.85906312823,171688.58036597492,224162.88279805557,332147.5526819311,125643.16435198345
1000,218729.48935518216,64804.45415508803,173644.57690728805,218610.08661295244,357403.71497006307,18059.71502669489
10000,143790.94828889717,44472.53288733788,162559.73559819476,82039.03267299477,289004.0518322682,1674.9432137929612
100000,35712.408241261044,11461.013689383273,99909.66569366025,15236.606656340335,149436.75087655275,170.69591493006303

,protobuf (decode),binary-encoder (decode),binary-encoder-compiled (decode),json (decode)
10,888843.5927172618,305803.3415753891,570503.5158795862,1087998.6920098183
100,849158.20272219,309056.5345350961,481219.4509456205,631152.9125705716
1000,907313.1785145177,339065.13895150385,580952.110157544,138365.14403254417
10000,848061.1820993097,338013.1009018717,563350.7465400948,16073.098278377967
100000,842279.1236521575,316650.2037582322,591702.3236950247,1632.3852198601567
</code></pre>
<h2>Contributing</h2>
<p>The source is documented with JSDoc. To generate the documentation use:</p>
<pre class="prettyprint source lang-bash"><code>npm run docs
</code></pre>
<p>Extra debugging information is printed using the <code>debug</code> module:</p>
<pre class="prettyprint source lang-bash"><code>DEBUG=binary-encoder:* npm t
</code></pre>
<p>The documentation will be put in the new <code>docs</code> directory.</p>
<p>To introduce an improvement please fork this project, commit changes in a new branch to your fork and add a pull request on this repository pointing at your fork. Please follow these style recommendations when working on the code:</p>
<ul>
<li>Use tabs (yup).</li>
<li>Use <code>async</code>/<code>await</code> and/or <code>Promise</code> where possible.</li>
<li>Features must be properly tested.</li>
<li>New methods must be properly documented with <code>jscode</code> style comments.</li>
</ul></article>
    </section>






    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.2</a> on Wed Jun 12 2019 14:15:03 GMT+0200 (Central European Summer Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>